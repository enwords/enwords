<% sentence_audio_nil = nil %>
<% sentence_id = nil %>
<div class="container training-div">

  <% if @sentences.empty? %>
      <%= t("training.no_translate")%> "<%= t("devise.registration.edit.diversity_enable") %>" <%= link_to t("training.in_settings"), edit_user_registration_path %> <%=  %>
  <% else %>
      <% @sentences.each do |sentence| %>
          <% sentence_id = sentence.id %>
          <div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2" id="training-sentence-translate">
            <% sentence_audio_nil = sentence.audio.nil? %>
            <% if sentence_audio_nil %>
                <span class="audioButton glyphicon glyphicon-volume-off"></span>
            <% else %>
                <span class="audioButton glyphicon glyphicon-volume-up" onclick="play()"></span>
                <%= audio_tag("https://audio.tatoeba.org/sentences/#{sentence.language}/#{sentence.id}.mp3", id: 'audio-play') %>
            <% end %>
            <h3 id="training-sentence" onclick="play()"><%= sentence.sentence %> </h3>
            <br>
            <% begin %>
                <% trans = sentence.translations.where(language: current_user.native_language).first.sentence %>
                <button id="translate-btn"><%= t "training.show_translation" %></button>
                <h4 id="translate" style="display: none"><%= trans %> </h4>
            <% rescue %>
            <% end %>
          </div>

          <div class="col-xs-12" id="compare-btn-div">
            <div class="digg_pagination">
              <% if params[:page] == @page_sum.to_s %>
                  <div id="pagination-training-without_disabled_links">
                    <%= will_paginate @sentences, page_links: false, previous_label: '<i class="fa fa-angle-left"></i>',
                                      next_label: '<i class="fa fa-angle-right"></i>', container: false %>
                    <%= link_to t("training.end"), result_path, id: "end_link" %>
                  </div>
              <% elsif @page_sum == 1 %>
                  <div id="pagination-training">
                    <%= link_to t("training.end"), result_path, id: "end_link" %>
                  </div>
              <% else %>
                  <div id="pagination-training">
                    <%= will_paginate @sentences, page_links: false, previous_label: '<i class="fa fa-angle-left"></i>',
                                      next_label: '<i class="fa fa-angle-right"></i>', container: false %>
                  </div>
              <% end %>
            </div>
          </div>
      <% end %>
  <% end %>
  <div id="words_in_sentence"></div>

</div>


<script>

  <% if current_user.audio_enable && !sentence_audio_nil && request.original_url != request.referer %>
  $("#audio-play")[0].play();
  <% end %>
  $("#translate-btn").click(function () {
    $("#translate-btn").fadeOut(0);
    $("#translate").fadeIn(750);
  });

  $.ajax({
    url: "/words_in_sentence/" + <%= sentence_id %>
  }).done(function (html) {
    return $("#words_in_sentence").replaceWith(html);
  });
</script>
